# FinderLedge 要件定義書

## 1. プロジェクトの目的・背景
FinderLedgeは、OpenAI Agents SDKと組み合わせてエージェントに動的な文書コンテキストを提供するためのドキュメント管理ライブラリです。ユーザーが文書を追加・削除するだけで、Embedding（ベクトル埋め込み）計算やBM25によるインデックス更新、キャッシュ構築などを自動で行い、数百〜数千規模のドキュメントから関連情報を効率的に検索・取得します。

### 1.1 プロジェクトの目的
- 文書コンテキストの自動管理と効率的な検索機能の提供
- OpenAI Agents SDKとの緊密な連携による文書知識の活用
- 自然言語クエリとキーワード検索の両方に対応した高精度な検索の実現

### 1.2 プロジェクトの背景
- 大量の文書から関連情報を効率的に検索する必要性の増加
- LLMエージェントが文書知識を活用する際の基盤技術の需要
- 既存の検索システムでは、意味的な関連性とキーワードのマッチの両方を考慮した検索が困難

## 2. 利用者と困りごと

### 2.1 利用者の種類
| 利用者 | 説明 |
|--------|------|
| 開発者 | アプリケーションに文書検索機能を組み込む開発者 |
| エンドユーザー | 文書検索機能を使用する一般ユーザー |
| LLMエージェント | 文書知識を活用するAIエージェント |

### 2.2 利用者のゴール
| 利用者 | ゴール |
|--------|--------|
| 開発者 | 簡単に文書検索機能を実装し、効率的な文書管理を実現する |
| エンドユーザー | 自然な質問で必要な文書を素早く見つける |
| LLMエージェント | 文書知識を活用して正確な回答を生成する |

### 2.3 利用者の制約
| 利用者 | 制約 |
|--------|------|
| 開発者 | - 複雑な実装を避けたい<br>- パフォーマンスとスケーラビリティを重視 |
| エンドユーザー | - 技術的な知識がない<br>- 直感的な操作を求める |
| LLMエージェント | - 構造化されたデータ形式を必要とする<br>- 高速なレスポンスを要求する |

### 2.4 利用者の困りごと
| 利用者 | 困りごと |
|--------|----------|
| 開発者 | - 文書検索機能の実装が複雑<br>- パフォーマンスの最適化が困難<br>- 文書管理の自動化が難しい |
| エンドユーザー | - キーワード検索では関連文書を見つけにくい<br>- 自然言語での質問に答えられない<br>- 大量の文書から必要な情報を見つけるのが大変 |
| LLMエージェント | - 文書知識の効率的な活用が難しい<br>- リアルタイムな文書更新への対応が困難<br>- 検索結果の構造化が複雑 |

## 3. 採用する技術スタック

### 3.1 コアライブラリ
| ライブラリ | バージョン | 用途 |
|------------|------------|------|
| bm25s-j | 最新版 | 日本語対応BM25検索 |
| langchain | 最新版 | LLM統合フレームワーク |
| langchain-openai | 最新版 | OpenAIモデル用ラッパー |
| langchain-community | 最新版 | コミュニティツール |
| chromadb | 最新版 | ベクトルデータベース |
| openai | 最新版 | OpenAI API クライアント |
| ollama | 最新版 | ローカルモデル用クライアント |
| numpy | 最新版 | 数値計算 |
| pydantic | 最新版 | データバリデーション |

### 3.2 開発ツール
| ツール | バージョン | 用途 |
|--------|------------|------|
| Python | 3.8以上 | 開発言語 |
| uv | 最新版 | パッケージ管理 |
| pytest | 最新版 | テストフレームワーク |
| black | 最新版 | コードフォーマッター |
| isort | 最新版 | インポート整理 |

## 4. 機能（ユースケース）一覧

### 4.1 文書管理機能
| 機能ID | 機能名 | 説明 | 優先度 | 利用者 |
|--------|--------|------|--------|--------|
| UC-01 | 文書インポート | テキスト、PDF、Officeファイルなどの文書を自動パース | 高 | 開発者 |
| UC-02 | インデックス自動更新 | EmbeddingとBM25インデックスの自動更新・キャッシュ | 高 | 開発者 |
| UC-03 | 文書削除 | 指定した文書のインデックスからの削除 | 中 | 開発者 |

### 4.2 検索機能
| 機能ID | 機能名 | 説明 | 優先度 | 利用者 |
|--------|--------|------|--------|--------|
| UC-04 | ハイブリッド検索 | ベクトル検索とキーワード検索の統合 | 高 | 全ユーザー |
| UC-05 | 検索モード選択 | 検索手法の切り替え（ハイブリッド/セマンティック/キーワード） | 中 | 開発者 |
| UC-06 | 関連コンテキスト取得 | 検索結果の構造化されたテキスト生成 | 高 | LLMエージェント |

### 4.3 インデックス管理機能
| 機能ID | 機能名 | 説明 | 優先度 | 利用者 |
|--------|--------|------|--------|--------|
| UC-07 | インデックス永続化 | ベクトルストアとBM25インデックスのローカル保存 | 高 | 開発者 |
| UC-08 | インデックスロード | 保存されたインデックスの読み込み | 高 | 開発者 |
| UC-09 | インデックス更新 | 差分更新による効率的なインデックス更新 | 中 | 開発者 |

### 4.4 OpenAI Agents SDK連携機能
| 機能ID | 機能名 | 説明 | 優先度 | 利用者 |
|--------|--------|------|--------|--------|
| UC-10 | ツール統合 | エージェントのツールとしてFinderLedgeを利用 | 高 | 開発者 |
| UC-11 | コンテキスト統合 | エージェントのコンテキストとしてFinderLedgeを利用 | 高 | 開発者 |
| UC-12 | LangChain連携 | LangChainのRetrieverとしてFinderLedgeを利用 | 中 | 開発者 | 